name: seafile

services:
  db:
    image: mariadb:10.11
    container_name: seafile-mysql
    user: 0:0
    cpu_shares: 70
    deploy:
      resources:
        limits:
          memory: 512M
    restart: unless-stopped
    environment:
      - MYSQL_ROOT_PASSWORD=$default_pwd
      - MYSQL_USER=seafile
      - MYSQL_PASSWORD=$default_pwd
      - MYSQL_LOG_CONSOLE=true
      - MARIADB_AUTO_UPGRADE=1
    volumes:
      - /DATA/AppData/seafile/db:/var/lib/mysql
      - /DATA/AppData/seafile/init:/docker-entrypoint-initdb.d
    networks:
      - seafile-network
    healthcheck:
      test:
        [
          "CMD",
          "/usr/local/bin/healthcheck.sh",
          "--connect",
          "--mariadbupgrade",
          "--innodb_initialized",
        ]
      interval: 20s
      start_period: 30s
      timeout: 5s
      retries: 10

  redis:
    image: redis:7.2-alpine
    container_name: seafile-redis
    user: 0:0
    cpu_shares: 70
    deploy:
      resources:
        limits:
          memory: 128M
    restart: unless-stopped
    command:
      - /bin/sh
      - -c
      - redis-server --requirepass "$$REDIS_PASSWORD"
    environment:
      - REDIS_PASSWORD=$default_pwd
    networks:
      - seafile-network

  seafile:
    image: seafileltd/seafile-mc:13.0-latest
    container_name: seafile
    hostname: seafile
    user: 0:0
    cpu_shares: 70
    deploy:
      resources:
        limits:
          memory: 1024M
    restart: unless-stopped
    expose:
      - 80
    volumes:
      - /DATA/AppData/seafile/data:/shared
      - /DATA/Media:/shared/seafile-data/library-template:ro
      - /DATA/Documents:/shared/seafile-data/documents
    environment:
      - PUID=$PUID
      - PGID=$PGID
      - SEAFILE_MYSQL_DB_HOST=db
      - SEAFILE_MYSQL_DB_PORT=3306
      - SEAFILE_MYSQL_DB_USER=seafile
      - SEAFILE_MYSQL_DB_PASSWORD=$default_pwd
      - INIT_SEAFILE_MYSQL_ROOT_PASSWORD=$default_pwd
      - SEAFILE_MYSQL_DB_CCNET_DB_NAME=ccnet_db
      - SEAFILE_MYSQL_DB_SEAFILE_DB_NAME=seafile_db
      - SEAFILE_MYSQL_DB_SEAHUB_DB_NAME=seahub_db
      - TIME_ZONE=$TZ
      - INIT_SEAFILE_ADMIN_EMAIL=admin@$domain
      - INIT_SEAFILE_ADMIN_PASSWORD=$default_pwd
      - SEAFILE_SERVER_HOSTNAME=seafile-$domain
      - SEAFILE_SERVER_PROTOCOL=https
      - SITE_ROOT=/
      - NON_ROOT=false
      - JWT_PRIVATE_KEY=e5Yrzk6Sibrle5Yrzk6Sibrl$default_pwd
      - SEAFILE_LOG_TO_STDOUT=false
      - ENABLE_SEADOC=false
      - CACHE_PROVIDER=redis
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - REDIS_PASSWORD=$default_pwd
      - ENABLE_NOTIFICATION_SERVER=false
      - ENABLE_SEAFILE_AI=false
      - MD_FILE_COUNT_LIMIT=100000
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_started
    networks:
      - seafile-network

networks:
  seafile-network:
    name: seafile-network

x-casaos:
  main: seafile
  webui_port: 80
  category: Cloud
  architectures: [amd64, arm64]
  author: Yundera Team
  developer: Seafile Ltd.
  pre-install-cmd: |
    mkdir -p /DATA/AppData/seafile/{data,db,init} &&
    cat > /DATA/AppData/seafile/init/01-seafile-permissions.sql << 'EOF'
    CREATE DATABASE IF NOT EXISTS ccnet_db;
    CREATE DATABASE IF NOT EXISTS seafile_db;
    CREATE DATABASE IF NOT EXISTS seahub_db;
    GRANT ALL PRIVILEGES ON ccnet_db.* TO 'seafile'@'%';
    GRANT ALL PRIVILEGES ON seafile_db.* TO 'seafile'@'%';
    GRANT ALL PRIVILEGES ON seahub_db.* TO 'seafile'@'%';
    FLUSH PRIVILEGES;
    EOF
    chown -R $PUID:$PGID /DATA/AppData/seafile &&
    chmod -R 755 /DATA/AppData/seafile
  title:
    en_us: Seafile
  tagline:
    en_us: Open source file sync and share solution
  icon: https://cdn.jsdelivr.net/gh/Worph/AppStore@main/Apps/Seafile/icon.png
  screenshot_link:
    - https://cdn.jsdelivr.net/gh/Worph/AppStore@main/Apps/Seafile/screenshot-1.png
    - https://cdn.jsdelivr.net/gh/Worph/AppStore@main/Apps/Seafile/screenshot-2.png
    - https://cdn.jsdelivr.net/gh/Worph/AppStore@main/Apps/Seafile/screenshot-3.png
  description:
    en_us: |
      **ðŸŒŠ What is Seafile?**

      **Seafile** is a professional open-source file sync and share platform. Think of it as **your own private Dropbox** that you fully control.

      Unlike cloud storage services, Seafile gives you complete ownership of your data while providing enterprise-grade file synchronization, sharing, and collaboration features.

      **ðŸ”§ What Can You Do with Seafile?**

      â€¢ ðŸ“ **File Synchronization**: Sync files across all your devices automatically
      â€¢ ðŸ”— **Secure Sharing**: Share files and folders with password protection and expiration dates  
      â€¢ ðŸ‘¥ **Team Collaboration**: Create shared libraries for team projects
      â€¢ ðŸ“± **Mobile Access**: Access your files from iOS and Android apps
      â€¢ ðŸ”’ **Client-Side Encryption**: Optional end-to-end encryption for sensitive data
      â€¢ ðŸ“Š **Version Control**: Keep track of file changes with automatic versioning
      â€¢ ðŸ’¬ **Real-time Collaboration**: Comment and collaborate on files in real-time

      **ðŸš€ Why Choose Seafile?**

      â€¢ **Privacy First** â€” Your files stay on your server, never on third-party clouds
      â€¢ **High Performance** â€” Optimized for large files and many concurrent users
      â€¢ **Cross-Platform** â€” Works on Windows, macOS, Linux, iOS, and Android
      â€¢ **Enterprise Ready** â€” Active Directory integration, advanced permissions, audit logs
      â€¢ **Reliable Sync** â€” Robust synchronization algorithm handles conflicts intelligently

      **ðŸ› ï¸ Perfect For:**

      â€¢ Personal file storage and sync across devices
      â€¢ Small teams needing secure file sharing
      â€¢ Organizations requiring data sovereignty
      â€¢ Anyone wanting Dropbox functionality without vendor lock-in

      **ðŸ“± Client Apps Available:**
      
      Download official Seafile clients for your devices to sync files automatically:
      â€¢ Desktop: Windows, macOS, Linux
      â€¢ Mobile: iOS App Store, Google Play Store
  tips:
    before_install:
      en_us: |
        **ðŸš€ Quick Setup Guide**
        
        **1. First Launch:**
        
        â€¢ Initial setup may take a few minutes
        â€¢ Admin account will be created automatically
        
        **Default Credentials:**
        | Field    | Value           |
        | -------- | --------------- |
        | Email    | `admin@$domain` |
        | Password | `$default_pwd`  |
        
        **2. After Login:**
        
        â€¢ Change default admin password in settings
        â€¢ Create your first library (like a folder that syncs)
        â€¢ Download Seafile client apps for your devices
        
        **3. File Storage:**
        
        â€¢ Files stored in: `/DATA/AppData/seafile/data`
        â€¢ Media template: `/DATA/Media` (read-only access)
        â€¢ Documents: `/DATA/Documents` (full access)
        
        **4. Download Client Apps:**
        
        â€¢ Visit seafile.com to download desktop and mobile clients
        â€¢ Use your server URL to connect and sync files
  index: /