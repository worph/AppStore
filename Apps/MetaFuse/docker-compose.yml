name: metafuse

services:
  metafuse:
    image: ghcr.io/worph/meta-fuse:latest
    container_name: metafuse
    restart: unless-stopped
    privileged: true

    # Web UI, API, and WebDAV port
    expose:
      - 80

    # FUSE capabilities required for virtual filesystem
    devices:
      - /dev/fuse:/dev/fuse

    cap_add:
      - SYS_ADMIN
      - DAC_READ_SEARCH
      - DAC_OVERRIDE

    security_opt:
      - apparmor:unconfined

    volumes:
      # Shared files volume (same as MetaSort - contains watch, plugin, poster, remotes)
      - metamesh-files:/files:ro

      # User's media directories (same paths as MetaSort)
      - /DATA/Downloads:/files/watch/downloads:ro
      - /DATA/Media:/files/watch/media:ro

      # Shared infrastructure volume (leader election, service discovery, Redis)
      # Mounted at fixed path so all MetaMesh apps share the same data
      - /DATA/Apps/MetaCore:/meta-core:rw

      # FUSE virtual filesystem mount point
      - /DATA/MetaFuse/Library:/mnt/virtual:shared

      # Configuration storage
      - /DATA/AppData/metafuse/config:/meta-fuse/config:rw

    environment:
      - NODE_ENV=production
      - META_CORE_PATH=/meta-core
      - FILES_PATH=/files
      - CONFIG_DIR=/meta-fuse/config
      - REDIS_URL=redis://metasort:6379
      - SERVICE_NAME=meta-fuse
      - SERVICE_VERSION=1.0.0
      - BASE_URL=https://metafuse-$APP_DOMAIN
      - TZ=$TZ

    # Note: Runs as root for FUSE mount operations
    user: 0:0

    networks:
      - metamesh

volumes:
  metamesh-files:
    external: true

networks:
  metamesh:
    external: true

x-casaos:
  architectures:
    - amd64
    - arm64
  author: Worph Team
  category: Media
  developer: Aptero Team

  description:
    en_us: |
      **Access your media library through a beautifully organized virtual filesystem.**

      MetaFuse creates a virtual view of your media (Movies, TV Shows, Anime) organized by metadata - while your actual files stay exactly where they are. Access via FUSE mount or WebDAV network share.

      **Key Features:**
      - **Zero File Movement** - Your files stay in place, MetaFuse creates an organized virtual view
      - **FUSE Virtual Filesystem** - Mount as a local directory on your system
      - **WebDAV Network Access** - Access your organized library as a network drive from any device
      - **Smart Organization** - Files organized by title, year, season, episode automatically
      - **Real-time Updates** - Virtual filesystem updates instantly when MetaSort processes new files
      - **Plex/Jellyfin Ready** - Point your media server to the organized virtual library

      **Requires:** MetaSort (for metadata extraction and Redis)

      **Perfect for:** Plex/Jellyfin users, media archivists, or anyone wanting an organized view without reorganizing files

    fr_fr: |
      **Accédez à votre bibliothèque multimédia via un système de fichiers virtuel magnifiquement organisé.**

      MetaFuse crée une vue virtuelle de vos médias (Films, Séries TV, Anime) organisée par métadonnées - pendant que vos fichiers restent exactement où ils sont. Accès via montage FUSE ou partage réseau WebDAV.

      **Fonctionnalités Clés:**
      - **Zéro Déplacement de Fichiers** - Vos fichiers restent en place, MetaFuse crée une vue virtuelle organisée
      - **Système de Fichiers Virtuel FUSE** - Montez comme un répertoire local sur votre système
      - **Accès Réseau WebDAV** - Accédez à votre bibliothèque organisée comme un lecteur réseau
      - **Organisation Intelligente** - Fichiers organisés par titre, année, saison, épisode automatiquement
      - **Mises à Jour Temps Réel** - Le système virtuel se met à jour instantanément

      **Nécessite:** MetaSort (pour l'extraction de métadonnées et Redis)

  tagline:
    en_us: Virtual filesystem for organized media access - FUSE mount and WebDAV without moving files
    fr_fr: Système de fichiers virtuel pour accès média organisé - Montage FUSE et WebDAV sans déplacer de fichiers

  title:
    en_us: MetaFuse

  icon: https://cdn.jsdelivr.net/gh/Worph/AppStore@main/Apps/MetaFuse/icon.png
  screenshot_link:
    - https://cdn.jsdelivr.net/gh/Worph/AppStore@main/Apps/MetaFuse/screenshot-1.png
    - https://cdn.jsdelivr.net/gh/Worph/AppStore@main/Apps/MetaFuse/screenshot-2.png
    - https://cdn.jsdelivr.net/gh/Worph/AppStore@main/Apps/MetaFuse/screenshot-3.png
  thumbnail: https://cdn.jsdelivr.net/gh/Worph/AppStore@main/Apps/MetaFuse/thumbnail.png

  index: /
  store_app_id: metafuse
  main: metafuse
  is_uncontrolled: false
  webui_port: 80
